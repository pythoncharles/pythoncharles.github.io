---
layout: post
category: web
title:  "AWS ELB技术要点"
tags: [阅读,网络]
date: 2019-06-12 10:05:01
---
AWS ELB技术的描述主要有一下几点:
* ELB优点
* ELB提供的功能
* ELB的局限性
<!-- more -->
#### 一、ELB优点
+ ELB支持自动扩展；
+ 可对后端的EC2运行状态检查
+ 支持TCP协议，支持加密协议SSL/TLS
+ 配置简单
 
#### 二、ELB提供的功能
1、运行状况检查
    为了查明AmazonEC2 实例的可用性,ELB会定期发送 ping,尝试进行连接或者发送请求来测试 Amazon EC2 实例。
    这些测试称为运行状况检查。若要让ELB确认实例正常运行,每个注册的 Amazon EC2 实例必须使用 HTTP 状态代码 200 对发出运行状况检查的目标做出响应。
 
2、跨区域负载均衡
    设置ELB,使其在一个区域内的一个可用区内或多个可用区内分配传入 的流量。默认情况下,ELB节点会将流量路由到同一可用区内的后端实例。
    为确保后端实例能够处理每个可用区中的请求负载,每个区域中必须保持大致相等的实例数。例如,如果在“cn-north-1a”可用区内有十个实例,
    在“cn-north-1b”可用区内有两个实例,则流量仍会在两个可用区内平均分配。
    因此,“cn-north-1b”内的两个实例便会与“cn-north-1a”内的十个实例承担相同的流量。
    如果要在所有后端实例间均匀地路由请求流量,而不论它们在哪个可用区,则应在负载均衡器上启用跨区域负载均衡。
    跨区域负载均衡可使每个ELB节点在多个可用区间路由请求,以便实现更高的容错能力。
    注意：这里的区域指的是AZ（可用区）非region（地区）
 
3、代理协议
    使用为 TCP/SSL 连接配置的ELB时,代理协议标头可帮助识别客户端的 IP 地址。因为ELB会拦截客户端与后端实例之间的流量,
    所以后端实例的访问日志中将包含ELB的 IP 地址而不是原始客户端的 IP 地址。在启用代理协议后,ELB会添加一个人类可读格式标头,
    其包含连接信息,如源 IP 地址、目标 IP 地址以及客户端的端口号。该标头随后作为请求的一部分发送到后端实例。
    我们可以分析该请求的第一行,以检索客户端的 IP 地址和端口号。
 
4、粘性会话
    默认情况下,ELB会将每项请求单独路由到负载最小的应用程序实例。不过, 可以使用粘性会话功能(也称为“会话关联”),
    使ELB能够将用户的会话绑定到特定应用程序实例。这样可以确保在会话期间,来自同一用户的所有请求均将被发送到相同的应用程序实例中。
    注意：粘性会话只限于HTTP/HTTPS 协议
 
5、连接耗尽
    当在ELB上启用连接耗尽时,要取消注册的任何后端实例都将在取消注册 之前完成正在进行的请求。
    同样,如果后端实例未能通过运行状况检查,ELB 将不会向运行状况不佳的实例发送任何新请求,但允许完成现有请求,
    同时确保继续为进行中的请求提供服务。这意味着,可以在不影响客户体验的情况下执行维护任务,比如部署软件升级或替换后端实例。
 
6、日志管理
    ELB提供日志记录的功能，可以将所有进出ELB的流量登记到日志中，并保存到制定的S3目录下。
 
#### 三、ELB的局限性
1、TCP空包不能传输
    ELB是基于应用层的程序，所以应用层以下发起的网络是不能被透传的，例如：基于TCP层产生的Keepalive，不可以穿透ELB传输；
 
2、只能在同已VPC中使用
    ELB属于地区性的应用，所以它只能在一个VPC中使用，后端的EC2必须置于这两个VPC的子网下。